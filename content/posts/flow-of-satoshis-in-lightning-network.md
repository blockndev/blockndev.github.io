---
title: "Движение сатошей в Лайтнинге"
date: 2019-12-25T00:00:00+00:00
categories: [Биткоин, LightningNetwork]
---

Как мы уже выяснили, прежде чем начать пользоваться Лайтнингом, необходимо открыть канал и зарезервировать в нем сколько-то битков/сатошей. Этот резерв и будет лимитом канала: через канал нельзя провести больше сатошей, чем было зарезервировано. Но как именно происходит движение сатошей в канале? Сейчас разберёмся.

Открытие канала происходит через транзакцию на блокчейне Биткоина. Тут важно зафиксировать пару деталей:
1. В транзакции запирается некоторая сумма битков.
2. Транзакция открывает канал между двумя сторонами (нодами).
3. Движение сатошей может происходить только между этими нодами.
4. Пропускная способность канала ограничена изначально зарезервированной суммой сатошей.

Отсюда становится видна суть работы каналов: **зарезервированные в канале сатоши «перетекают» от одной стороны к другой**. При резервировании сатошей есть возможность указать, на чьей стороне они изначально находятся и в каком количестве. Все последующие движения сатошей просто перемещают их от одной стороны к другой. Примерно как переворачивающиеся песочные часы.

У такой механики есть один важный момент, с которым можно столкнуться при ручном открытии канала. Объем канала двухсторонний: есть **входящий объём** и есть **исходящий объём**. Входящий объём указывает кол-во сатошей, которое вы можете получить. Исходящий объём указывает кол-во сатошей, которое вы можете потратить. При отправке сатошей исходящий объём расходуется, а входящий пополняется. При получении — наоборот.

Рассмотрим простой пример: открыт канал на 1 биткоин, в котором за нодой А зарезервировано 0.7 битка, а за нодой Б — 0.3.
```
0.7                   0.3
 |——————————————|——————|
 А                     Б
```

Через такой канал нода А может отправить не больше 0.7 битка и получить не больше 0.3 битка. Нода А отправила 0.1 битка ноде Б:
```
0.6                   0.4
 |————————————|————————|
 А                     Б
```

Теперь нода А может отправить на 0.1 битка меньше, но получить может на 0.1 битка больше. Нода Б отправила ноде А 0.3 битка:

```
0.9                   0.1
 |———————————————————|—|
 А                     Б
```
Входящий объем для ноды А в этом канале почти исчерпан, для ноды Б — наоборот.

Из всего этого вытекает важное правило, если вы открываете каналы руками (или кто-то открывает канал к вашей ноде). Чтобы получать сатоши, нужно:
1. Чтобы кто-то открыл канал к вашей ноде и зарезервировал за вашей нодой сколько-то сатошей.
2. Либо чтобы вы открыли канал к другой ноде и зарезервировали за ней сколько-то сатошей.

Ну и следствие всего этого: чем больше вы тратите, тем больше можете получить, и наоборот.

(На текущий момент каналы не пополняемы, их нужно переоткрывать, но работа в этом направлении ведется.)