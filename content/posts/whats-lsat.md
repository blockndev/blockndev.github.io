---
title: "LSAT: токен аутентификации в сервисах с оплатой через Лайтнинг"
date: 2020-04-03T00:00:00+00:00
categories: [LightningNetwork]
---

Пару дней назад компания Lightning Labs представила новый протокол LSAT: Lightning Service Authentication Token. Протокол описывает способ аутентификации и оплаты за использование сервисов через Лайтнинг. Другими словами, это платежный шлюз для API-серверов с автоматической и гибкой оплатой сатошами через Lightning Network.

Пару лет назад Blockstream проводили неделю приложений на LN. Одно из приложений было как раз таким платёжным шлюзом. Идея простая: у вас есть какой-то сервис, который предоставляет услуги пользователям. Допустим, это сервис типа CoinMarketCap. У сервиса есть АПИ, через который разработчики могут получать какие-то данные. АПИ, конечно, не полностью бесплатное: есть бесплатный план, и есть платные планы, которые позволяют получать больше данных. Платные планы чаще всего оплачиваются вперед на месяц или год, но иногда используется система кредитов: один платный запрос стоит сколько-то кредитов, которые вы заранее покупаете в зависимости от ваших потребностей. LSAT это как раз технология для оплаты за использование вот таких платных АПИ, но оплата происходит автоматически в процессе запроса данных через АПИ.

**Как это работает.**
Сервер отправляет запрос к платному АПИ, АПИ возвращает HTTP-статус `402 Payment Required` (в спецификации HTTP этот статус зарезервирован на будущее, и вот будущее настало!). Вместе с ответом приходит инвойс и токен: инвойс — для оплаты за использование АПИ, токен — даёт доступ к АПИ, но активируется только после оплаты. Вы оплачиваете инвойс через Лайтнинг и получаете в обмен preimage — это такая секретная последовательность байт, которую вы фактически и покупаете за сатоши в Лайтнинге (как-нибудь разберём тонкости работы Лайтнинга). Имея preimage и токен, вы теперь можете отправить запрос к АПИ, передав их в запросе. Все это происходит автоматически, если вы используете специальный кошелёк, и занимает пару секунд.

Как я уже говорил, идея не новая, просто сейчас они взяли и оформили это в спецификацию. На мой взгляд это довольно интересная технология, которая позволяет платить, например, 1 сатоши за один запрос к АПИ — быть может когда-то все сайты будут использовать такой механизм оплаты за визиты, взамен избавляя людей от рекламы и слежки. Но с другой стороны, внедрять такое решение сегодня никто не будет. Причин несколько:
1. Крипта чужда традиционному финансовому миру. Собирать оплату за сервис в крипте будут только фанаты.
2. Сложно настраивать сервер. Нужно запускать Биткоин-ноду, Лайтнинг-ноду и программировать/подключать шлюз.
3. (Почти) нету готовых и удобных решений для пользователей.
4. Гибкий план оплаты выгоден пользователям, но не бизнесам.

Идея интересная, технология перспективная, но массовое применение ей пока не найдено. Значит, нужно искать дальше!

Также Lightning Labs выпустили:
1. Реализацию шлюза на Golang: https://github.com/lightninglabs/aperture
2. Библиотеку на Node.js: https://github.com/Tierion/lsat-js

Спецификация LSAT: https://github.com/lightninglabs/LSAT